# -*- coding: utf-8 -*-
"""semi final good code vateluthu.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oO19TvgIBpwpiZk2WP-piPCk2mRvaeLX
"""

from google.colab import files
import zipfile
import os

# Upload the zip file
uploaded = files.upload()

# Extract it
zip_filename = next(iter(uploaded))
extract_path = "/content/vatteluttu_glyphs"
os.makedirs(extract_path, exist_ok=True)

with zipfile.ZipFile(zip_filename, 'r') as zip_ref:
    zip_ref.extractall(extract_path)

print("тЬЕ Folder extracted to:", extract_path)
print("ЁЯУБ Files inside:", os.listdir(extract_path))

!pip install gradio opencv-python

import gradio as gr
import cv2
import os
import numpy as np

extract_path = "/content/vatteluttu_glyphs"

glyph_map = {
    "ka.png": "роХ",
    "na.png": "рои",
    "ma.png": "роо",
    "ti.png": "родро┐",
    "pa.png": "рок",
}

def match_image(image):
    try:
        input_img = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        input_img = cv2.resize(input_img, (100, 100))

        best_score = -1
        best_match = "рокродро┐ро▓ро┐ро▓рпНро▓рпИ"

        for filename in os.listdir(extract_path):
            if not filename.endswith(".png"):
                continue
            template = cv2.imread(os.path.join(extract_path, filename), 0)
            template = cv2.resize(template, (100, 100))

            result = cv2.matchTemplate(input_img, template, cv2.TM_CCOEFF_NORMED)
            _, score, _, _ = cv2.minMaxLoc(result)

            if score > best_score:
                best_score = score
                best_match = filename

        return glyph_map.get(best_match, "рокродро┐ро▓ро┐ро▓рпНро▓рпИ")
    except:
        return "рокроЯродрпНродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ"

# ЁЯОи Gradio UI
with gr.Blocks(title="ро╡роЯрпНроЯрпЖро┤рпБродрпНродрпБ роЙро░рпИ рооро╛ро▒рпНро▒ро┐") as demo:
    gr.Markdown(
        """
        <div style="text-align:center; font-size: 26px; font-weight: bold;">ЁЯк╢ ро╡роЯрпНроЯрпЖро┤рпБродрпНродрпБ тЖТ родрооро┐ро┤рпН рооро╛ро▒рпНро▒ро┐</div>
        <div style="text-align:center; font-size: 16px; margin-bottom: 20px;">рокро┤рпИроп родрооро┐ро┤рпН роОро┤рпБродрпНродрпБроХрпНроХро│рпИ рокроЯрооро╛роХ рокродро┐ро╡рпЗро▒рпНро▒рпБроЩрпНроХро│рпН тАУ роЗроЩрпНроХрпБ роЕро╡рпИ роиро╡рпАрой родрооро┐ро┤ро┐ро▓рпН роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпБроорпН.</div>
        """,
        elem_id="title",
    )

    with gr.Row():
        with gr.Column(scale=1):
            image_input = gr.Image(
                label="ЁЯУ╖ роЙроЩрпНроХро│рпН ро╡роЯрпНроЯрпЖро┤рпБродрпНродрпБ рокроЯроорпН", type="numpy", image_mode="RGB", height=300
            )
            gr.Markdown("*роЙродро╛ро░рогроорпН: роХро▓рпНро╡рпЖроЯрпНроЯрпБ роОро┤рпБродрпНродрпБроХрпНроХро│рпН, родрпКро▓рпНро▓ро┐ропро▓рпН роирпЖро▒ро┐роорпБро▒рпИроХро│рпН рокрпЛройрпНро▒ро╡рпИ.*")
            submit_btn = gr.Button("ЁЯФН роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХро╡рпБроорпН", size="lg")

        with gr.Column(scale=1):
            text_output = gr.Textbox(
                label="ЁЯУЬ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ (роиро╡рпАрой родрооро┐ро┤рпН)",
                max_lines=1,
                show_copy_button=True,
                elem_id="output-text"
            )




    submit_btn.click(fn=match_image, inputs=image_input, outputs=text_output)

demo.launch()

!pip install gradio opencv-python